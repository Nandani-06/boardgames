#!/bin/bash

# Check if input file is provided
if [ $# -ne 1 ]; then
    echo "Usage: $0 <input_file>"
    exit 1
fi

file="$1"

# Check file exists
if [ ! -f "$file" ]; then
    echo "File not found: $file"
    exit 1
fi

# Set delimiter (you can extend this if you want .tsv support)
delimiter=';'

# Read header line to extract column names
IFS= read -r header < "$file"
IFS="$delimiter" read -ra columns <<< "$header"

# Initialize array to store empty counts for each column
num_columns=${#columns[@]}
declare -a empty_counts
for ((i=0; i<num_columns; i++)); do
    empty_counts[i]=0
done

# Read file line by line, starting after header
tail -n +2 "$file" | while IFS= read -r line || [ -n "$line" ]; do
    IFS="$delimiter" read -ra fields <<< "$line"
    for ((i=0; i<num_columns; i++)); do
        field="${fields[i]}"
        # Trim whitespace and check if empty
        trimmed=$(echo "$field" | xargs)
        if [ -z "$trimmed" ]; then
            ((empty_counts[i]++))
        fi
    done
done

# Print final results
echo "Running empty_cells on the complete dataset, $file, the following counts are reported:"
for ((i=0; i<num_columns; i++)); do
    echo "${columns[i]}: ${empty_counts[i]}"
done

